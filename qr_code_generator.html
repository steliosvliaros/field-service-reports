<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Order QR Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            background: #f3f4f6;
        }
        .header {
            background: #1f2937;
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h2 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #4b5563;
            font-weight: 500;
            font-size: 14px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #2563eb;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 16px;
        }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-success {
            background: #10b981;
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin-top: 10px;
        }
        .btn-success:hover { background: #059669; }
        .btn-secondary {
            background: #6b7280;
            color: white;
            width: 100%;
            padding: 12px;
            font-size: 14px;
            margin-top: 10px;
        }
        .btn-secondary:hover { background: #4b5563; }
        #qrcode {
            display: flex;
            justify-content: center;
            padding: 30px;
            background: white;
            border-radius: 8px;
            margin: 20px 0;
        }
        #qrcode canvas, #qrcode img {
            border: 3px solid #e5e7eb;
            border-radius: 8px;
        }
        .qr-container {
            display: none;
        }
        .info-box {
            background: #eff6ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1e40af;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“± Work Order QR Code Generator</h1>
        <p>Generate QR codes with pre-configured work order data for field technicians</p>
    </div>

    <div class="section">
        <div class="info-box">
            ðŸ’¡ <strong>How it works:</strong> Fill in the work order details below and generate a QR code. 
            Your technician can scan this QR code with the Field Service App to auto-fill all information.
        </div>

        <h2>Work Order Information</h2>
        <label>Work Order ID *</label>
        <input type="text" id="workOrderId" placeholder="Enter work order number" required>

        <h2>Customer Information</h2>
        <label>Customer Name *</label>
        <input type="text" id="customerName" placeholder="Enter customer name" required>
        
        <label>Lead Name</label>
        <input type="text" id="leadName" placeholder="Contact person name">
        
        <label>Lead Phone</label>
        <input type="tel" id="leadPhone" placeholder="Phone number">
        
        <label>Lead Contact</label>
        <input type="text" id="leadContact" placeholder="Email or additional contact">

        <h2>Machinery Information</h2>
        <label>Manufacturer *</label>
        <select id="manufacturer" required>
            <option value="">Select manufacturer</option>
            <option value="RAVO">RAVO</option>
            <option value="BAUMANN">BAUMANN</option>
            <option value="MITSUBISHI">MITSUBISHI</option>
            <option value="LIUGONG">LIUGONG</option>
            <option value="CMC">CMC</option>
            <option value="MECALAC">MECALAC</option>
            <option value="TERBERG">TERBERG</option>
        </select>
        
        <label>Model</label>
        <input type="text" id="model" placeholder="Enter model">
        
        <label>VIN/Serial Number</label>
        <input type="text" id="serialNumber" placeholder="Enter VIN or serial number">

        <h2>GitHub Settings (Optional)</h2>
        <label>GitHub Personal Access Token</label>
        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx (optional)">
        
        <label>GitHub Repository</label>
        <input type="text" id="githubRepo" placeholder="username/repository-name">

        <button class="btn-primary" onclick="generateQR()">ðŸŽ¯ Generate QR Code</button>
    </div>

    <div class="section qr-container" id="qrSection">
        <h2>Generated QR Code</h2>
        <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px; text-align: center;">
            Work Order: <strong id="displayWO"></strong>
        </p>
        <div id="qrcode"></div>
        <div class="grid-2">
            <button class="btn-success" onclick="downloadQR()">ðŸ’¾ Download QR Code</button>
            <button class="btn-secondary" onclick="resetForm()">ðŸ”„ Create Another</button>
        </div>
    </div>

    <script>
        let currentQRData = null;

        // Load saved GitHub settings
        if (localStorage.getItem('qrGithubToken')) {
            document.getElementById('githubToken').value = localStorage.getItem('qrGithubToken');
        }
        if (localStorage.getItem('qrGithubRepo')) {
            document.getElementById('githubRepo').value = localStorage.getItem('qrGithubRepo');
        }

        function generateQR() {
            const workOrderId = document.getElementById('workOrderId').value.trim();
            const customerName = document.getElementById('customerName').value.trim();
            const manufacturer = document.getElementById('manufacturer').value;

            // Validation
            if (!workOrderId || !customerName || !manufacturer) {
                alert('Please fill in Work Order ID, Customer Name, and Manufacturer');
                return;
            }

            // Collect data
            const qrData = {
                workOrderId: workOrderId,
                customerName: customerName,
                leadName: document.getElementById('leadName').value.trim(),
                leadPhone: document.getElementById('leadPhone').value.trim(),
                leadContact: document.getElementById('leadContact').value.trim(),
                manufacturer: manufacturer,
                model: document.getElementById('model').value.trim(),
                serialNumber: document.getElementById('serialNumber').value.trim(),
                githubToken: document.getElementById('githubToken').value.trim(),
                githubRepo: document.getElementById('githubRepo').value.trim()
            };

            // Save GitHub settings
            if (qrData.githubToken) {
                localStorage.setItem('qrGithubToken', qrData.githubToken);
            }
            if (qrData.githubRepo) {
                localStorage.setItem('qrGithubRepo', qrData.githubRepo);
            }

            currentQRData = qrData;

            // Clear previous QR code
            document.getElementById('qrcode').innerHTML = '';

            // Generate QR code
            new QRCode(document.getElementById('qrcode'), {
                text: JSON.stringify(qrData),
                width: 300,
                height: 300,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });

            // Show QR section
            document.getElementById('displayWO').textContent = workOrderId;
            document.getElementById('qrSection').style.display = 'block';
            
            // Scroll to QR code
            setTimeout(() => {
                document.getElementById('qrSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function downloadQR() {
            if (!currentQRData) return;

            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                alert('QR code not generated yet');
                return;
            }

            // Create a larger canvas with label
            const downloadCanvas = document.createElement('canvas');
            const ctx = downloadCanvas.getContext('2d');
            downloadCanvas.width = 400;
            downloadCanvas.height = 480;

            // White background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, downloadCanvas.width, downloadCanvas.height);

            // Add QR code
            ctx.drawImage(canvas, 50, 60, 300, 300);

            // Add text labels
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('WORK ORDER QR CODE', 200, 30);

            ctx.font = '18px Arial';
            ctx.fillText(`WO #${currentQRData.workOrderId}`, 200, 390);

            ctx.font = '14px Arial';
            ctx.fillText(currentQRData.customerName, 200, 415);
            ctx.fillText(`${currentQRData.manufacturer} - ${currentQRData.model || 'N/A'}`, 200, 435);

            ctx.font = '12px Arial';
            ctx.fillStyle = '#666666';
            const date = new Date().toLocaleDateString();
            ctx.fillText(`Generated: ${date}`, 200, 460);

            // Download
            downloadCanvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `WO_${currentQRData.workOrderId}_${new Date().toISOString().split('T')[0]}.png`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        function resetForm() {
            document.getElementById('workOrderId').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('leadName').value = '';
            document.getElementById('leadPhone').value = '';
            document.getElementById('leadContact').value = '';
            document.getElementById('manufacturer').value = '';
            document.getElementById('model').value = '';
            document.getElementById('serialNumber').value = '';
            document.getElementById('qrSection').style.display = 'none';
            currentQRData = null;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>